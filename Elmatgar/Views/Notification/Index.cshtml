 
    <input type="hidden" id="userListIdHidden" value="Noti" />
 

<div class="container">
    <br /><br /><br />
    <div style="height:520px;">
        <div class="alert-info" style="width: 180px;"><label for="discussion"></label></div>
     
        <input type="hidden"  id="message"/> <br />
        <input  type="hidden" id="sendmessage" value="Send" class="btn btn-success" style="height:40px;width:100px;" />
        <input type="hidden" id="displayname" />
        <input type="hidden" id="connection" />
       
    </div>

    <audio controls="controls" id="sound1" style="width:0px;">
        <source src="~/sounds/newuser.wav" />
    </audio>
    <audio controls="controls" id="sound2" style="width:0px;">
        <source src="~/sounds/alert.wav" />
    </audio>

</div>

@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
<script src="~/Scripts/jquery-1.10.2.js"></script>
    <!--Reference the SignalR library. -->
<script src="~/Scripts/jquery.signalR-2.2.1.min.js"></script>
 

    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script>
       
        $(function () {

            var chat = $.connection.chatHub;
           
            chat.client.addNewMessageToPage = function (name, message, connectionid) {
                if (connectionid == $('#connection').val()) {
         $("label[for='discussion']").html('<li><strong>' + htmlEncode(name)
                        + '</strong>: ' + htmlEncode(message) + '</li>');
                   
                };
            };
            //for connect to chat
            chat.client.addconnMessage = function (name, message, connectionid) {
                if (connectionid == $('#connection').val()) {

                   // Add the message to the page.
                  $("label[for='discussion']").html('<li><strong>' + htmlEncode(name)
                        + '</strong>: ' + htmlEncode(message) + '</li>');
                };
            };
            //for desconnect from chat
            chat.client.adddesconnMessage = function (name, message, connectionid) {
                if (connectionid == $('#connection').val()) {

                     // Add the message to the page.
                  $("label[for='discussion']").html('<li><strong>' + htmlEncode(name)
                        + '</strong>: ' + htmlEncode(message) + '</li>');
                };
            };
           
            // Get the user name and store it to prepend to messages.
            $('#displayname').val(document.getElementById("userListIdHidden").value);
            $('#connection').val(document.getElementById("userListIdHidden").value);

            // Set initial focus to message input box.
            $('#message').focus();
            // Start the connection.
            $.connection.hub.start().done(function () {
                var sound1 = $("#sound1")[0];
                sound1.play();
                var currentdate = new Date();
                var datetime = currentdate.getDate() + "/"
                                + (currentdate.getMonth() + 1) + "/"
                                + currentdate.getFullYear() + " time"
                                + currentdate.getHours() + ":"
                                + currentdate.getMinutes() + ":"
                                + currentdate.getSeconds();
                //for connection
                chat.server.connectMessage($('#displayname').val(), 'mr admin attention : ' + ' ' + $('#displayname').val() + ' ' + 'is connected ' + ' ' + 'at' + ' ' + datetime + ' ' + '  ' + ' ' , 'Noti');
                $('#sendmessage').click(function () {
                    var sound2 = $("#sound2")[0];
                    sound2.play();
                    // Call the Send method on the hub.
                    chat.server.send($('#displayname').val(), $('#message').val(), $('#connection').val());
                    // Clear text box and reset focus for next comment.
                    $('#message').val('').focus();
                });
              

                //for using enter key to send
                $('#message').keyup(function (event) {
                    if (event.keyCode == 13) {
                        $('#sendmessage').click();
                    }
                });

            });
        });
        // This optional function html-encodes messages for display in the page.
        function htmlEncode(value) {
            var encodedValue = $('<div />').text(value).html();
            return encodedValue;
        }

       
    </script>
}
